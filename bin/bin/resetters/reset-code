#!/usr/bin/env bash

# This script resets your VSCode setting files;
# use the following arguments to run it:
#     [ --novi ] reset VSCode with few goodies
#     [ --rice ] rice your VSCode config files
#     [ --zero ] remove all config (rm -rf ~/.config/Code/User/*)

# Extension:
#     GITHUB-COPILOT  https://marketplace.visualstudio.com/items?itemName=GitHub.copilot
#     MONOKAI-PRO     https://marketplace.visualstudio.com/items?itemName=monokai.theme-monokai-pro-vscode

# This very configurations can be also used to rice up your VSCode-Insiders.
# Just remember to use `~/.config/Code - Insiders/User` as your base directory.




### First things first
######################

if [[ ! -x "$(command -v code)" ]]; then
    printf "\n"
    printf "═══════ Warning: VSCode not found ══════\n"
    printf "Install VSCode and run this script again\n"
    exit 1
fi


if [[ $# -gt 1 ]]; then
    printf "\n"
    printf "═══════════════════ Warning ═══════════════════\n"
    printf "Too many arguments: no operations were executed\n"
    exit 1
elif [[ $# -eq 0 ]]; then
    printf "╔════════════════════════════ Help ═══════════════════════════╗\n"
    printf "║ [ --novi ] reset VSCode with few goodies                    ║\n"
    printf "║ [ --rice ] rice your VSCode config files                    ║\n"
    printf "║ [ --zero ] remove all config (rm -rf ~/.config/Code/User/*) ║\n"
    printf "╚═════════════════════════════════════════════════════════════╝\n"
    exit 0
elif [[ $1 != "--novi" && $1 != "--rice" && $1 != "--zero" ]]; then
    printf "\n"
    printf "══════════════════ Warning ══════════════════\n"
    printf "Unknown argument: no operations were executed\n"
    exit 1
fi




### Ready?
##########

read -p "Resetting VSCode (enter to continue)"




### ~/.config/Code/User
#######################

BASE=${HOME}/.config/Code/User
[[ -d "${BASE}" ]] || mkdir -p "${BASE}"




### Zero
########

if [[ $1 == "--zero" ]]; then
    printf "REMOVING ALL VSCODE CONFIG\n"
    for EXTENSION in $(code --list-extensions); do
        code --uninstall-extension "${EXTENSION}" &>/dev/null
    done
    rm -f "${BASE}/settings.json"
    rm -f "${BASE}/keybindings.json"
    # ---
    printf "\n"
    printf "══════════════ We're done here ═════════════\n"
    printf "Enjoy your vanilla VSCode with no extensions\n"
    exit 0
fi




### Rice
########

if [[ $1 == "--rice" ]]; then
    "${EDITOR:=vi}" -p "${BASE}/settings.json" "${BASE}/keybindings.json"
    # ---
    printf "\n"
    printf "════════════ We're done here ════════════\n"
    printf "Are you happy now? Stop wasting your time\n"
    exit 0
fi




### Novi
########

printf "RESETTING VSCODE WITH FEW GOODIES\n"
for EXTENSION in $(code --list-extensions); do
    code --uninstall-extension "${EXTENSION}" &>/dev/null
done
code --install-extension github.copilot &>/dev/null
code --install-extension monokai.theme-monokai-pro-vscode &>/dev/null
# ---
CODE="${HOME}/bin/resetters/code"
cat "${CODE}/settings.json" > "${BASE}/settings.json"
cat "${CODE}/keybindings.json" > "${BASE}/keybindings.json"


printf "\n"
printf "═════════ We're done here ═════════\n"
printf "Enjoy your Non-Vim life with VSCode\n"
