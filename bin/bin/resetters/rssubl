#!/usr/bin/env bash

# This script just resets your Sublime Text
# and Merge config: no options, no nothing.




### Ready?
##########

read -p "Resetting Sublime Text/Merge (enter to continue)"




### Text and Merge settings folder
##################################

STEXT="$HOME/.config/sublime-text/Packages/User"
SMERGE="$HOME/.config/sublime-merge/Packages/User"
[[ -d "$STEXT" ]] || mkdir -p "$STEXT"
[[ -d "$SMERGE" ]] || mkdir -p "$SMERGE"




### Reset Text settings
#######################

cat 2>/dev/null > $STEXT/Preferences.sublime-settings <<-EOF
{
    "theme": "auto",
    "color_scheme": "Mariana.sublime-color-scheme",
    "font_face": "Fira Code",
    "font_size": 8.5,
    "font_options": ["dlig"],
    "fold_buttons": false,
    "rulers": [120],
    "translate_tabs_to_spaces": true,
    "caret_extra_top": 1,
    "caret_extra_bottom": 1,
    "draw_indent_guides": false,
    "reveal_menu": false,
    "hot_exit": "only_on_quit",
    "sublime_merge_path": "~/.local/bin/smerge",
    "preview_on_click": false,
}
EOF




### Reset Text keybindings
##########################

cat 2>/dev/null > $STEXT/Default\ \(Linux\).sublime-keymap <<-EOF
[
    { "keys": ["alt+s"], "command": "toggle_comment", "args": { "block": false } },
    { "keys": ["alt+shift+s"], "command": "toggle_comment", "args": { "block": true } },
]
EOF




### Reset Merge settings
########################

cat 2>/dev/null > $SMERGE/Preferences.sublime-settings <<-EOF
{
    "font_face": "Fira Code",
    "font_size": 8.5,
    "hide_menu": true,
    "render_commit_dialog_message_at_top": false,
    "side_bar_layout": "tabs",
    "translate_tabs_to_spaces": true,
    "editor_path": "~/.local/bin/subl",
}
EOF




### Link Text executable
########################

if [[ ! -f "$HOME/.local/bin/subl" ]]; then
    if [[ -f "/usr/bin/subl" ]]; then
        ln -s /usr/bin/subl "$HOME/.local/bin/subl"
    elif [[ -f "/snap/bin/subl" ]]; then
        ln -s /snap/bin/subl "$HOME/.local/bin/subl"
    fi
fi




### Link Merge executable
#########################

if [[ ! -f "$HOME/.local/bin/smerge" ]]; then
    if [[ -f "/usr/bin/smerge" ]]; then
        ln -s /usr/bin/smerge "$HOME/.local/bin/smerge"
    elif [[ -f "/snap/bin/smerge" ]]; then
        ln -s /snap/bin/smerge "$HOME/.local/bin/smerge"
    fi
fi




### Edit Sublime config
#######################

"${EDITOR:=vi}" -p \
    "$STEXT/Preferences.sublime-settings" \
    "$STEXT/Default (Linux).sublime-keymap" \
    "$SMERGE/Preferences.sublime-settings"
