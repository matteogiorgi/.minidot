#!/usr/bin/env bash

# This script resets VSCode setting to a more Vim-like experience.
# Flag --code or no flag resets VSCode, flag --insiders resets VSCode Insiders.


### Ready?
##########

read -p "Resetting VSCode Vim-Syle (enter to continue)"

# ---

_reset () {
    [[ -x "$(command -v "${CODE}")" && -d "${USER}" ]] || return
    printf "%s\n" "${OPERATION}"
    # ---
    LIST=$("${CODE}" --list-extensions)
    for EXTENSION in "${LIST}"; do
        "${CODE}" --uninstall-extension "${EXTENSION}" &>/dev/null
    done
    # ---
    "${CODE}" --install-extension vspacecode.vspacecode &>/dev/null
    "${CODE}" --install-extension monokai.theme-monokai-pro-vscode &>/dev/null
    # ---
    cat "${CONF}/settings.json" > "${USER}/settings.json"
    cat "${CONF}/keybindings.json" > "${USER}/keybindings.json"
    # ---
    ((COUNT++))
}

# ---

# vspacecode configuration files (settings and keybindings) folder
# and a counter to check if at least one operation was executed
CONF="~/.bin/resetters/code"
COUNT=0




### Reset extensions
####################

if [[ $# -eq 0 || $1 == "--code" ]]; then
    OPERATION="RESETTING CODE"
    USER="~/.config/Code/User"
    CODE="code"
    # ---
    _reset
fi

# ---

if [[ $1 == "--insiders" ]]; then
    OPERATION="RESETTING CODE-INSIDERS"
    USER="~/.config/Code\ -\ Insiders/User"
    CODE="code-insiders"
    # ---
    _reset
fi




### Bye bye
###########

printf "\n"
if [[ $COUNT -eq 0 ]]; then
    printf "==================== Warning! ====================\n"
    printf "Something went wrong: no operations were executed.\n"
else
    printf "=========== We're done here ===========\n"
    printf "Enjoy your Vim-Styled life with VSCode!\n"
fi
