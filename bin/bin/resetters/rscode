#!/usr/bin/env bash

# This script resets VSCode setting using VSpaceCode extensions pack:
#   noflag     -> resets VSCode only
#   --insiders -> resets VSCode Insiders instead of VSCode
#
# Here the full set of extensions installed by this script (for more information visit https://vspacecode.github.io/):
# VSpaceCode, Which Key, Vim, fuzzy-search, File Browser, edamagit, Monokai Pro.


### Ready?
##########

read -p "Resetting VSCode Vim-Syle (enter to continue)"

# ---

_reset () {
    [[ -x "$(command -v "${CODE}")" && -d "${USER}" ]] || return
    printf "%s\n" "${OPERATION}"
    # ---
    LIST=$("${CODE}" --list-extensions)
    for EXTENSION in $LIST; do
        "${CODE}" --uninstall-extension "${EXTENSION}" &>/dev/null
    done
    # ---
    "${CODE}" --install-extension vspacecode.vspacecode &>/dev/null
    "${CODE}" --install-extension monokai.theme-monokai-pro-vscode &>/dev/null
    # ---
    cat "${CONF}/settings.json" > "${USER}/settings.json"
    cat "${CONF}/keybindings.json" > "${USER}/keybindings.json"
    # ---
    ((COUNT++))
}

# ---

# VSpaceCode configuration files (settings and keybindings) folder
# and a numeric counter to check if at least one operation was executed.
CONF="${HOME}/bin/resetters/code"
COUNT=0




### Reset extensions
####################

if [[ $# -eq 0 || $1 == "--code" ]]; then
    OPERATION="RESETTING CODE"
    USER="${HOME}/.config/Code/User"
    CODE="code"
    # ---
    _reset
fi

# ---

if [[ $1 == "--insiders" ]]; then
    OPERATION="RESETTING CODE-INSIDERS"
    USER="${HOME}/.config/Code - Insiders/User"
    CODE="code-insiders"
    # ---
    _reset
fi




### Bye bye
###########

printf "\n"
if [[ $COUNT -eq 0 ]]; then
    printf "==================== Warning! ====================\n"
    printf "Something went wrong: no operations were executed.\n"
else
    printf "=========== We're done here ===========\n"
    printf "Enjoy your Vim-Styled life with VSCode!\n"
fi
