#!/usr/bin/env bash

# This script resets Helix editor:
#   noflag -> resets Helix
#   --zero -> removes config




### Ready?
##########

read -p "Resetting Helix editor (enter to continue)"




### Check
#########

if [[ ! -x "$(command -v "hx")" ]]; then
    printf "\n"
    printf "===================== Warning! =====================\n"
    printf "Helix is not installed: no operations were executed.\n"
    exit 1
fi


if [[ $# -gt 1 ]]; then
    printf "\n"
    printf "=================== Warning! ===================\n"
    printf "Too many arguments: no operations were executed.\n"
    exit 1
elif [[ $# -eq 1 && $1 != "--zero" ]]; then
    printf "\n"
    printf "================== Warning! ==================\n"
    printf "Unknown argument: no operations were executed.\n"
    exit 1
fi




### ~/.config/helix
###################

# Helix main folder (~/.config/helix),
# let's create it if it doesn't exist!
HELIX=${HOME}/.config/helix
[[ -d "$HELIX" ]] || mkdir -p "$HELIX"




### Zero
########

if [[ $1 == "--zero" ]]; then
    printf "REMOVING CONFIG\n"
    rm -f "${HELIX}/config.toml" &>/dev/null
    # ---
    printf "\n"
    printf "=========== We're done here ===========\n"
    printf "Enjoy your Helix editor with no config.\n"
    exit 0
fi




### Reset configurations
########################

if [[ -f "$HELIX/config.toml" ]]; then
    hx $HELIX/config.toml
    exit 0
fi


cat 2>/dev/null > $HELIX/config.toml <<-EOF
theme = "autumn_night"

[editor]
line-number = "relative"
bufferline = "multiple"
cursorline = true
color-modes = true
auto-save = true
mouse = true

[editor.cursor-shape]
insert = "bar"
normal = "block"
select = "underline"

[editor.lsp]
display-signature-help-docs = false
display-inlay-hints = true

[keys.normal]
esc = ["collapse_selection", "keep_primary_selection"]
EOF


printf "\n"
printf "========= We're done here =========\n"
printf "Enjoy your post-modern text editor.\n"
