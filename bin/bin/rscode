#!/usr/bin/env bash


### Info
########

read -p "Resetting VS-Code setup Vim-Syle (enter to continue)"
if [[ -n "$1" ]]; then
    if [[ "$1" != "insiders" ]]; then
        printf "%s is not a valid option\n" "$1"
        exit 1
    fi
    CODE="code-insiders"
    FOLDER="Code - Insiders"
else
    CODE="code"
    FOLDER="Code"
fi

# after we decide if we wanto to reset code or
# code-insiders, let's check if it's installed
if [[ ! -x "$(command -v "$CODE")" ]]; then
    printf "%s is not installed\n" "$CODE"
    exit 1
fi




### Remove installed extensions
###############################

LIST=$("$CODE" --list-extensions)
for EXTENSION in $LIST; do
    "$CODE" --uninstall-extension "$EXTENSION" &>/dev/null
done




### Install config
##################

printf "INSTALLING VSCODE-VIM\n"
"$CODE" --install-extension vscodevim.vim &>/dev/null

printf "INSTALLING MONOKAI-PRO\n"
"$CODE" --install-extension monokai.theme-monokai-pro-vscode &>/dev/null

# (over)write our personal config-file
# (~/.config/Code/User/settings.json)
printf "WRITING OPTIONS CONFIG. FILE\n"
cat 2>/dev/null > "${HOME}"/.config/"${FOLDER}"/User/settings.json <<-EOF
{
    "keyboard.dispatch": "keyCode",
    "breadcrumbs.enabled": true,
    "telemetry.telemetryLevel": "off",
    "security.workspace.trust.enabled": false,
    "security.workspace.trust.emptyWindow": false,
    "security.workspace.trust.banner": "never",
    "security.workspace.trust.startupPrompt": "never",
    "window.restoreWindows": "none",
    "window.titleBarStyle": "native",
    "window.menuBarVisibility": "hidden",
    "window.customMenuBarAltFocus": false,
    "window.enableMenuBarMnemonics": false,
    "editor.fontFamily": "'Fira Code', 'monospace'",
    "editor.fontSize": 11.5,
    "editor.lineHeight": 1.3,
    "editor.lineNumbers": "relative",
    "editor.renderLineHighlight": "none",
    "editor.fontLigatures": true,
    "editor.guides.indentation": false,
    "editor.minimap.enabled": false,
    "editor.rulers": [],
    "editor.folding": false,
    "editor.wordWrap": "off",
    "editor.cursorBlinking": "solid",
    "editor.cursorStyle": "line",
    "editor.scrollbar.vertical": "auto",
    "editor.scrollbar.horizontal": "hidden",
    "editor.scrollbar.verticalScrollbarSize": 10,
    "editor.scrollbar.horizontalScrollbarSize": 0,
    "editor.stickyScroll.enabled": true,
    "debug.terminal.clearBeforeReusing": true,
    "terminal.explorerKind": "external",
    "terminal.external.linuxExec": "lxterm",
    "terminal.integrated.fontFamily": "'Fira Code', 'monospace'",
    "terminal.integrated.fontSize": 11.5,
    "terminal.integrated.lineHeight": 1,
    "terminal.integrated.allowChords": false,
    "terminal.integrated.gpuAcceleration": "off",
    "terminal.integrated.profiles.linux": {
        "dash": { "path": "/bin/dash" },
        "bash": { "path": "/bin/bash" },
    },
    "terminal.integrated.defaultProfile.linux": "dash",
    "workbench.editor.showTabs": false,
    "workbench.startupEditor": "none",
    "workbench.colorTheme": "Monokai Pro",
    "workbench.iconTheme": "Monokai Pro Icons",
    "workbench.productIconTheme": "Default",
    "workbench.activityBar.visible": false,
    "workbench.sideBar.location": "left",
    "workbench.editor.enablePreview": false,
    "workbench.editor.closeEmptyGroups": true,
    "workbench.list.openMode": "doubleClick",
    "workbench.tree.renderIndentGuides": "none",
    "workbench.tree.indent": 20,
    "vim.incsearch": true,
    "vim.useSystemClipboard": true,
    "vim.useCtrlKeys": true,
    "vim.hlsearch": true,
    "vim.leader": "<space>",
    "vim.insertModeKeyBindings": [],
    "vim.visualModeKeyBindings": [
        {
            "before": ["H"],
            "commands": ["editor.action.outdentLines"]
        },
        {
            "before": ["L"],
            "commands": ["editor.action.indentLines"]
        },
        {
            "before": ["J"],
            "commands": ["editor.action.moveLinesDownAction"]
        },
        {
            "before": ["K"],
            "commands": ["editor.action.moveLinesUpAction"]
        },
        {
            "before": ["<C-j>"],
            "after": ["}"]
        },
        {
            "before": ["<C-k>"],
            "after": ["{"]
        },
        {
            "before": ["<leader>", "<leader>"],
            "commands": ["editor.action.commentLine"]
        },
    ],
    "vim.normalModeKeyBindingsNonRecursive": [
        {
            "before": ["Y"],
            "after": ["y", "$"]
        },
        {
            "before": ["u"],
            "commands": ["undo"],
            "silent": true
        },
        {
            "before": ["C-r"],
            "commands": ["redo"],
            "silent": true
        },
        {
            "before": ["<C-j>"],
            "after": ["}"]
        },
        {
            "before": ["<C-k>"],
            "after": ["{"]
        },
        {
            "before": ["<leader>","w"],
            "after": ["<C-w>"]
        },
        {
            "before": ["<leader>", "<leader>"],
            "commands": ["editor.action.commentLine"],
            "silent": true
        },
    ],
}
EOF

# (over)write our personal kaymaps-file
# (~/.config/Code/User/keybindings.json)
printf "WRITING KEYMAPS CONFIG. FILE\n"
cat 2>/dev/null > $HOME/.config/"${FOLDER}"/User/keybindings.json <<-EOF
[
    {
        "key": "alt+shift+q",
        "command": "workbench.action.quit"
    },
    {
        "key": "alt+shift+w",
        "command": "workbench.action.closeWindow"
    },
    {
        "key": "alt+a",
        "command": "workbench.action.toggleActivityBarVisibility"
    },
    {
        "key": "alt+s",
        "command": "workbench.action.togglePanel"
    },
    {
        "key": "alt+v",
        "command": "toggleVim"
    },
    {
        "key": "ctrl+j",
        "command": "-workbench.action.togglePanel"
    },
    {
        "key": "alt+h",
        "command": "workbench.action.quickOpen"
    },
    {
        "key": "alt+shift+h",
        "command": "workbench.action.openRecent"
    },
    {
        "key": "alt+j",
        "command": "workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup",
        "when": "!activeEditorGroupEmpty"
    },
    {
        "key": "alt+j",
        "command": "workbench.action.quickOpenNavigateNextInEditorPicker",
        "when": "inEditorsPicker && inQuickOpen"
    },
    {
        "key": "alt+shift+j",
        "command": "editor.action.marker.next",
        "when": "editorFocus"
    },
    {
        "key": "alt+k",
        "command": "workbench.action.quickOpenLeastRecentlyUsedEditorInGroup",
        "when": "!activeEditorGroupEmpty"
    },
    {
        "key": "alt+k",
        "command": "workbench.action.quickOpenNavigatePreviousInEditorPicker",
        "when": "inEditorsPicker && inQuickOpen"
    },
    {
        "key": "alt+shift+k",
        "command": "editor.action.marker.prev",
        "when": "editorFocus"
    },
    {
        "key": "alt+l",
        "command": "workbench.action.toggleSidebarVisibility",
        "when": "sideBarFocus"
    },
    {
        "key": "alt+l",
        "command": "workbench.action.focusSideBar",
        "when": "!sideBarFocus"
    },
    {
        "key": "alt+shift+l",
        "command": "actions.find"
    },
    {
        "key": "alt+n",
        "command": "editor.action.inlineSuggest.showNext",
        "when": "inlineSuggestionVisible && !editorReadonly"
    },
    {
        "key": "alt+p",
        "command": "editor.action.inlineSuggest.showPrevious",
        "when": "inlineSuggestionVisible && !editorReadonly"
    },
    {
        "key": "alt+i",
        "command": "workbench.action.showCommands"
    },
    {
        "key": "alt+o",
        "command": "workbench.action.terminal.openNativeConsole",
        "when": "!terminalFocus"
    },
    {
        "key": "ctrl+j",
        "command": "workbench.action.quickOpenSelectNext",
        "when": "inQuickOpen"
    },
    {
        "key": "ctrl+k",
        "command": "workbench.action.quickOpenSelectPrevious",
        "when": "inQuickOpen"
    },
    {
        "key": "ctrl+j",
        "command": "selectNextSuggestion",
        "when": "suggestWidgetMultipleSuggestions && suggestWidgetVisible && textInputFocus"
    },
    {
        "key": "ctrl+k",
        "command": "selectPrevSuggestion",
        "when": "suggestWidgetMultipleSuggestions && suggestWidgetVisible && textInputFocus"
    },
    {
        "key": "ctrl+j",
        "command": "showNextParameterHint",
        "when": "editorFocus && parameterHintsMultipleSignatures && parameterHintsVisible"
    },
    {
        "key": "ctrl+k",
        "command": "showPrevParameterHint",
        "when": "editorFocus && parameterHintsMultipleSignatures && parameterHintsVisible"
    },
    {
        "key": "ctrl+j",
        "command": "selectNextCodeAction",
        "when": "codeActionMenuVisible"
    },
    {
        "key": "ctrl+k",
        "command": "selectPrevCodeAction",
        "when": "codeActionMenuVisible"
    },
]
EOF




### Bye bye
###########

printf "\n"
printf "Enjoy your Vim-Styled VSCode!\n"
