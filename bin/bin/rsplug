#!/usr/bin/env bash


### Info
########

read -p "Installing/updating your Vim plugins (enter to continue)"
if [[ ! -x "$(command -v "vim")" ]]; then
    printf "vim is not installed\n"
    exit 1
fi

[[ -d ~/.vim/pack/plugins/start ]] || mkdir -p ~/.vim/pack/plugins/start
cd ~/.vim/pack/plugins/start




### Plugin install/update
#########################

printf "\n"
if [[ ! -d fugitive ]]; then
    printf "INSTALLING FUGITIVE\n"
    git clone https://github.com/tpope/vim-fugitive fugitive
else
    printf "UPDATING FUGITIVE\n"
    cd fugitive
    git pull
    cd - &>/dev/null
fi

printf "\n"
if [[ ! -d commentary ]]; then
    printf "INSTALLING COMMENTARY\n"
    git clone https://github.com/tpope/vim-commentary commentary
else
    printf "UPDATING COMMENTARY\n"
    cd commentary
    git pull
    cd - &>/dev/null
fi

printf "\n"
if [[ ! -d surround ]]; then
    printf "INSTALLING SURROUND\n"
    git clone https://github.com/tpope/vim-surround surround
else
    printf "UPDATING SURROUND\n"
    cd surround
    git pull
    cd - &>/dev/null
fi

printf "\n"
if [[ ! -d repeat ]]; then
    printf "INSTALLING REPEAT\n"
    git clone https://github.com/tpope/vim-repeat repeat
else
    printf "UPDATING REPEAT\n"
    cd repeat
    git pull
    cd - &>/dev/null
fi

printf "\n"
if [[ ! -d context ]]; then
    printf "INSTALLING CONTEXT\n"
    git clone https://github.com/wellle/context.vim context
else
    printf "UPDATING CONTEXT\n"
    cd context
    git pull
    cd - &>/dev/null
fi

printf "\n"
if [[ ! -d autopairs ]]; then
    printf "INSTALLING AUTOPAIRS\n"
    git clone https://github.com/jiangmiao/auto-pairs autopairs
else
    printf "UPDATING AUTOPAIRS\n"
    cd autopairs
    git pull
    cd - &>/dev/null
fi

printf "\n"
if [[ ! -d ale ]]; then
    printf "INSTALLING ALE\n"
    git clone https://github.com/dense-analysis/ale ale
else
    printf "UPDATING ALE\n"
    cd ale
    git pull
    cd - &>/dev/null
fi




### Copilot install (Ubuntu only)
#################################

[[ -n "$1" && "$1" == "copilot" ]] || exit 1

if [[ "$(vim --version | grep -oE 'Vi IMproved 9')" != "Vi IMproved 9" ]]; then
    if [[ $(uname -a) =~ "Ubuntu" ]]; then
        printf "\n"
        printf "UPGRADING VIM\n"
        [[ $(grep -qr "^deb .*jonathonf/vim" /etc/apt/sources.list /etc/apt/sources.list.d/*) ]] || sudo add-apt-repository ppa:jonathonf/vim
        sudo apt update
        sudo apt install vim-gtk3
    else
        printf "\n"
        printf "This is not Ubuntu, you have to manually install Vim 9!\n"
        exit 1
    fi
fi

printf "\n"
if [[ ! -d copilot ]]; then
    printf "INSTALLING COPILOT\n"
    sudo apt install nodejs
    git clone https://github.com/github/copilot.vim copilot
else
    printf "UPDATING COPILOT\n"
    cd copilot
    git pull
    cd - &>/dev/null
fi

[[ ! -e "$HOME/.vim/pack/plugins/start/rsplug/plugin/rsplug.vim" ]] || cat 2>/dev/null > "$HOME/.vim/pack/plugins/start/rsplug/plugin/rsplug.vim" <<-EOF
" COPILOT CONFIG
let g:copilot_enabled = v:false
imap <silent><C-H> <Plug>(copilot-dismiss)
imap <silent><C-J> <Plug>(copilot-next)
imap <silent><C-K> <Plug>(copilot-previous)
imap <silent><C-L> <Plug>(copilot-suggest)
EOF




### Bye bye
###########

printf "Enjoy your Vim-Plugged life!\n"
